<div id="container"></div>

<style>
  #container {
    position: absolute;
    bottom: 20px; 
    left: 40%;
    transform: translateX(-50%);
    width: 400px;
    height: 260px;
    display: grid;
    grid-template-columns: repeat(20, 1fr); 
    grid-template-rows: repeat(13, 1fr);
    overflow: hidden;
    transition: all 0.3s ease;
    overflow: visible; 
  }

  .tile {
    position: relative;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .tile .layer1 {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-image: url("sniperwomen.png");
    background-size: 400px 260px;
  }

  .tile .layer2 {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-image: url("gun.png");
    background-size: 400px 260px;
  }

  /* å‹•ç•«çµæŸå¾Œè¦é¡¯ç¤ºçš„å®Œæ•´åœ– */
  #full-sniper {
    position: absolute;
    top: 0; left: 0;
    width: 400px; height: 260px;
    background-image: url("sniperwomen.png");
    background-size: 400px 260px;
    z-index: 1;
  }
  #full-gun {
    position: absolute;
    top: 0; left: 0;
    width: 400px; height: 260px;
    background-image: url("gun.png");
    background-size: 400px 260px;
    transform-origin: 20% 50%;
    z-index: 2;
  }

  #container.move-left {
    left: 0px; 
    bottom: 0px;
    transform: none;
  }
  .red-dot {
    position: fixed;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: red;
    pointer-events: none;
    transition: transform 1s linear;
  }
</style>

<script>
  const container = document.getElementById("container");
  const cols = 20, rows = 13;
  const width = container.clientWidth;
  const height = container.clientHeight;

  // å»ºç«‹ tile
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const tile = document.createElement("div");
      tile.className = "tile";

      const layer1 = document.createElement("div");
      layer1.className = "layer1";
      layer1.style.backgroundPosition = `-${(width/cols)*c}px -${(height/rows)*r}px`;

      const layer2 = document.createElement("div");
      layer2.className = "layer2";
      layer2.style.backgroundPosition = `-${(width/cols)*c}px -${(height/rows)*r}px`;

      tile.appendChild(layer1);
      tile.appendChild(layer2);
      container.appendChild(tile);
    }
  }

  // é¡¯ç¤ºé †åºï¼šå…ˆå¶æ•¸è¡Œå†å¥‡æ•¸è¡Œ
  const order = [];
  for (let c = 0; c < cols; c++) {
    for (let r = 0; r < rows; r += 2) order.push({r, c});
    for (let r = 1; r < rows; r += 2) order.push({r, c});
  }

  let acc = 5;
  order.forEach((pos, i) => {
    const index = pos.r * cols + pos.c;
    const tile = container.children[index];
    setTimeout(() => {
      tile.style.opacity = "1";
    }, i * acc);
    acc -= 0.015;
  });

  container.classList.add("move-left");

  // âœ… å°æ–¹å¡Šå‹•ç•«çµæŸ â†’ æ›æˆå®Œæ•´çš„åœ–
  const totalDelay = 400; 
  setTimeout(() => {
    // container.innerHTML = ""; // æ¸…ç©ºæ‰€æœ‰ tile

    // åŠ å®Œæ•´åœ–
    const sniper = document.createElement("div");
    sniper.id = "full-sniper";
    const gun = document.createElement("div");
    gun.id = "full-gun";
    const smoke = document.createElement("div");
    smoke.id = "smoke";
    smoke.style.width = "400px";
    smoke.style.height = "260px";
    smoke.style.backgroundSize = "contain";
    smoke.style.backgroundRepeat = "no-repeat";
    smoke.style.opacity = "0";
    smoke.style.transition = "opacity 0.5s ease";
    smoke.style.transformOrigin = "20% 50%";


// å»ºç«‹ä¸€å€‹ img ç‰©ä»¶ä¾†å–å¾—åŸå§‹åœ–ç‰‡å¤§å°
const img = new Image();
img.src = "smoky.png";
img.onload = () => {
 const xInImage = img.width;      // å³é‚Šç•Œ
  const yInImage = img.height / 3;

  // 2ï¸âƒ£ å–å¾— smoke åœ¨è¢å¹•ä¸Šçš„ä½ç½®
  const rect = smoke.getBoundingClientRect();

  // 3ï¸âƒ£ è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹ï¼ˆå› ç‚º backgroundSize=contain æœƒç¸®æ”¾ï¼‰
  const scaleX = rect.width / img.width;
  const scaleY = rect.height / img.height;

  // 4ï¸âƒ£ æŠŠåœ–ç‰‡åº§æ¨™è½‰æ›æˆå…ƒç´ å…§åº§æ¨™ï¼Œå†è½‰æˆè¢å¹•åº§æ¨™
  const screenX = rect.left + xInImage * scaleX;
  const screenY = rect.top + yInImage * scaleY;

  console.log("è¢å¹•ä¸Šçš„åº§æ¨™ï¼š", screenX, screenY);
};
smoke.style.backgroundImage = `url('${img.src}')`;

    container.appendChild(sniper);
    container.appendChild(gun);
    container.appendChild(smoke);

    // è®“ gun æ°¸é æŒ‡å‘æ»‘é¼ 
    window.addEventListener("mousemove", (e) => {
      const rect = container.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 4;
      const angle = (Math.atan2(e.clientY - cy, e.clientX - cx) * 180 / Math.PI);
      console.log ("è§’åº¦ï¼š", angle);
      gun.style.transform = `rotate(${angle}deg)`;
      smoke.style.transform = `rotate(${angle}deg)`;
    });   


  }, totalDelay);
function exitAnimation() {
  const cols = 20, rows = 13;
  const width = container.clientWidth;
  const height = container.clientHeight;

  // æ¸…æ‰åŸæœ¬å®Œæ•´åœ–
  container.innerHTML = "";

  // å»ºç«‹é€€å ´ç”¨ tile
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.style.opacity = "1"; // ä¸€é–‹å§‹æ˜¯æ»¿çš„

      const layer1 = document.createElement("div");
      layer1.className = "layer1";
      layer1.style.backgroundPosition = `-${(width/cols)*c}px -${(height/rows)*r}px`;

      const layer2 = document.createElement("div");
      layer2.className = "layer2";
      layer2.style.backgroundPosition = `-${(width/cols)*c}px -${(height/rows)*r}px`;

      tile.appendChild(layer1);
      tile.appendChild(layer2);
      container.appendChild(tile);
    }
  }

  // ğŸ”¹ é€€å ´é †åºï¼šæ•´åˆ—æ•´åˆ—å¾å³åˆ°å·¦
  const order = [];
  for (let c = cols - 1; c >= 0; c--) {
    for (let r = 0; r < rows; r++) {
      order.push({r, c});
    }
  }

  let acc = 2; // æ¯å€‹ tile é–“éš”
  order.forEach((pos, i) => {
    const index = pos.r * cols + pos.c;
    const tile = container.children[index];
    setTimeout(() => {
      tile.style.opacity = "0"; // æ¶ˆå¤±
    }, i * acc);
  });

  // å‹•ç•«çµæŸå¾Œæ¸…ç©º
  setTimeout(() => {
    container.innerHTML = "";
  }, order.length * acc + 500);
}

// æ¸¬è©¦ï¼š3ç§’å¾Œè‡ªå‹•é€€å ´
setTimeout(exitAnimation, 3000);



</script>
